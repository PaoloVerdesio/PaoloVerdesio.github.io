<!DOCTYPE html>
<html>
<head>
  <title>Il mio sito web</title>
</head>
<body>
  <h1>QUESTO MATHGATTO</h1>
  <img src="mathgatto.jpg" alt="Foto di mathgatto">
  <button id="inviaPosizione">Invia posizione</button>
  <p id="messaggio"></p>

  <script>
    document.getElementById("inviaPosizione").addEventListener("click", function() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          var latitudine = position.coords.latitude;
          var longitudine = position.coords.longitude;

          inviaEmail(latitudine, longitudine);

        }, function(error) {
          document.getElementById("messaggio").innerHTML = "Impossibile ottenere la posizione: " + error.message;
        });
      } else {
        document.getElementById("messaggio").innerHTML = "Geolocalizzazione non supportata dal browser.";
      }
    });

    function inviaEmail(latitudine, longitudine) {
      var url = "https://script.google.com/macros/s/AKfycbxTQhnrfwT74usWUW-UPXQGzDhyaPP6yAPXwjiBSDZl5Fms_sbb-q4pnJI5EAEF08bU/exec";
      var data = {
        latitudine: latitudine,
        longitudine: longitudine,
        timestamp: new Date().toISOString()
      };

      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(function(response) {
        if (!response.ok) {
          throw new Error("Errore HTTP: " + response.status);
        }
        return response.text();
      })
      .then(function(message) {
        document.getElementById("messaggio").innerHTML = message;
      })
      .catch(function(error) {
        document.getElementById("messaggio").innerHTML = "Errore: " + error.message;
        console.error("Errore fetch:", error); // Aggiunto console.error per debug
      });
    }
  </script>
</body>
</html>
