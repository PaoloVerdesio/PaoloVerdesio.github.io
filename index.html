<!DOCTYPE html>
<html>
<head>
  <title>Il mio sito web</title>
  <style>
    #inviaPosizione {
      background-color: red;
      color: white;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
    }
    #debug {
      background-color: #f0f0f0;
      padding: 10px;
      margin-top: 20px;
      font-family: monospace;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h1>QUESTO MATHGATTO</h1>
  <img src="mathgatto.jpg" alt="Foto di mathgatto">
  <button id="inviaPosizione">Invia posizione</button>
  <p id="messaggio"></p>
  <div id="debug"></div>

  <script>
    document.getElementById("inviaPosizione").addEventListener("click", function() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          var latitudine = position.coords.latitude;
          var longitudine = position.coords.longitude;

          inviaEmail(latitudine, longitudine);

        }, function(error) {
          document.getElementById("messaggio").innerHTML = "Impossibile ottenere la posizione: " + error.message;
          console.error("Errore geolocalizzazione:", error);
        });
      } else {
        document.getElementById("messaggio").innerHTML = "Geolocalizzazione non supportata dal browser.";
      }
    });

    function inviaEmail(latitudine, longitudine) {
      var url = "https://script.google.com/macros/s/AKfycbxTQhnrfwT74usWUW-UPXQGzDhyaPP6yAPXwjiBSDZl5Fms_sbb-q4pnJI5EAEF08bU/exec";
      var data = {
        latitudine: latitudine,
        longitudine: longitudine,
        timestamp: new Date().toISOString()
      };

      document.getElementById("debug").innerHTML = "URL: " + url + "\nDati inviati: " + JSON.stringify(data, null, 2);

      fetch(url, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(function(response) {
        document.getElementById("debug").innerHTML += "\nRisposta fetch: " + JSON.stringify(response, null, 2);
        if (!response.ok) {
          return response.text().then(function(text) {
            throw new Error("Errore HTTP: " + response.status + " " + response.statusText + " - " + text);
          });
        }
        return response.text();
      })
      .then(function(message) {
        document.getElementById("messaggio").innerHTML = message;
      })
      .catch(function(error) {
        document.getElementById("messaggio").innerHTML = "Errore: " + error.message;
        console.error("Errore fetch:", error);
        document.getElementById("debug").innerHTML += "\nErrore fetch: " + JSON.stringify(error, null, 2);
      });
    }
  </script>
</body>
</html>
